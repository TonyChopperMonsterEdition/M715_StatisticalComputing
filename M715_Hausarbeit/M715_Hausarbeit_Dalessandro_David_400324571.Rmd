---
title: "Regression der Opferstatistik"
subtitle: "Modul 715 - Statistical Computing"
author: "D'Alessandro David"
date: "`r format(Sys.Date())`"

output:  
  html_document:
    toc: true
    toc_float: true
    highlight: default 
    theme: paper
    css: "./09_Formatierung/stylesheetCaseStudy.css"
    number_sections: yes
    code_folding:  show #hide
  pdf_document:
    number_sections: yes
    toc: yes
    toc_depth: 3
  word_document:
    toc: yes
    toc_depth: 3
  github_document: default
bibliography: "./10_Literatur_Quellen/m715_references.bib"
csl: "https://www.zotero.org/styles/apa-with-abstract"
lang: en

##Formatierung
geometry: left=2cm,right=4cm,top=2cm,bottom=2cm

knit: (function(inputFile, encoding) {
      out_dir <- "08_Report";
      rmarkdown::render(inputFile,
                        encoding=encoding, 
                        output_file=file.path(dirname(inputFile), out_dir, 'M715_Hausarbeit_Dalessandro_David_400324571.html')) })

---
# Vorwort {.unnumbered}
```{r setup, include=FALSE}
# load libraries from before
#### zuvor geladen:
#library(rmarkdown)
library(knitr)
#library(bookdown)
#library(yaml)

# globaloptions
knitr::opts_chunk$set(echo = FALSE)

```
<!-- ohne Nummerierung   -->

# Introduction (1 page) {#Chapter1}
***
#	Methodology (4-5 pages): {#Chapter2}
Dieses Kapitel beschreibt und erläutert zum einen die Daten des Bundeskriminalamts ([Sec. 2.1][Dataset of the Federal Criminal Police Office]), sowie, die des Statistischen Bundesamts ([Sec. 2.2][Data set of the Federal Statistical Office]). Die Betrachtung hebt vor allem die relevanten Variablen in dieser Arbeit hervor. Zum anderen zeigt das Kapitel welche Aufbereitungsaufwände ([Sec. 2.3][Data Preparation]) notwendig sind, um die Fallzahlen zu modellieren ([Sec. 2.4][Modeling by using linear regression]). Unterstützend verwendet die Arbeit die nachfolgenden Bibliotheken.
```{r Libraries, echo=TRUE, message=FALSE, warning=FALSE}
# Libraries needed for the data exploration 
library(tidyverse)
library(dplyr)
library(purrr)
library(base)
library(data.table)
library(devtools)
library(htmlTable)
```

##	Dataset of the Federal Criminal Police Office
In diesem Abschnitt fokusiert das Kapitel die Daten des Bundeskriminalamts. Es gibt Einblick in die Struktur der Datensätze und erläutert, welche Maßnahmen ([Sec. 2.3][Data Preparation]) ergreifen muss, um ein Regressionsmodell abzuleiten. Für die Beschreibung und Auswertung verwendet die Arbeit die im Code Chunk aufgeführten Skripte. Sie laden einerseits die Datensätze des Bundeskriminalamts in die Umgebung des RMarkdown und bereiten andererseits Tabellen und Grafiken vor, die das RMarkdown in diesem Abschnitt einbettet.

``` {r Datasets & Scripts,echo=TRUE, message=FALSE, warning=FALSE}
# Loading Datasets over the following scripts
source("./00_Skripte/read_datafiles.r", local = knitr::knit_global())  ## Probleme mit dem Komma wo dezimal punkt und füllt nummern mit 000 auf am Ende
# Load self scripted functions for analysis, interpretation and visualization.
source("./00_Skripte/selbstgeschriebeneFunktionen.r", local = knitr::knit_global()) 


# Calculating and creating variables to embed and use them in the paper
# Smaller Thefts in Berlin in 2020 to show the example of the layers and how the figures are calculated
example_Ber <-  caseNumbers_2020[caseNumbers_2020$FederalState %like% "Berlin" & caseNumbers_2020$Crimetype %like% "Diebstahl",]
example_Ber_TheftOnly <- example_Ber[ str_detect(example_Ber$CrimeKey, "^31"),]
options(table_counter = TRUE, table_counter_str = "<b>Tab. %s:</b>")
cssCell_4_Ber_TheftOnly <- matrix("",ncol=ncol(example_Ber_TheftOnly), nrow=nrow(example_Ber_TheftOnly))
cssCell_4_Ber_TheftOnly[str_detect(example_Ber_TheftOnly$CrimeKey, "^310\\*") | str_detect(example_Ber_TheftOnly$CrimeKey, "^315\\*",)] <- "font.size: 1.1; font-weight: bold"

Table_Ber_TheftOnly <- addHtmlTableStyle(example_Ber_TheftOnly, 
                                           pos.caption = "bottom", 
                                           align="lllr",
                                           align.header = "lccr",
                                           css.cell= cssCell_4_Ber_TheftOnly)
Table_Ber_TheftOnly <- htmlTable(Table_Ber_TheftOnly, 
                                   rnames=FALSE, 
                                   tspanner = "Einfacher Diebstahl Ebene 2",
                                   n.tspanner = nrow(Table_Ber_TheftOnly),
                                   rgroup = c("Betriebsräumlichkeiten (Ebene 3)", "Gastronomieräumelichkeiten (Ebene 3)"),
                                   n.rgroup = c(9,nrow(Table_Ber_TheftOnly)-9),
                                   caption="Zahl der Diebstähle auf der 3. Detailebene im Bundesland Berlin im Jahr 2020",
                                   label="Table_Ber_TheftOnly")

# Crimes in Bremen in 2020 to show upperlayer for each crimetype and the relevant figures for the paper
example_Bremen_totalCrimeTypes <- caseNumbers_2020[caseNumbers_2020$FederalState %like% "Bremen" & caseNumbers_2020$Crimetype %like% "insgesamt und zwar:",]
Table_Bremen_totalCrimeTypes <- addHtmlTableStyle(example_Bremen_totalCrimeTypes, 
                                           pos.caption = "bottom", 
                                           align="lllr",
                                           align.header = "lccr")
Table_Bremen_totalCrimeTypes <- htmlTable(Table_Bremen_totalCrimeTypes, 
                                   rnames=FALSE, 
                                   tspanner = "Crimecases in total per Crimetype",
                                   n.tspanner = nrow(Table_Bremen_totalCrimeTypes),
                                   caption="Total Numbers per Crimetype in Berlin in 2020",
                                   label="Table_Bremen_totalCrimeTypes")


example_NationWideUntil2017 <- caseNumbers_2017[caseNumbers_2017$FederalState %like% "Bund echte" & caseNumbers_2017$Crimetype %like% "Diebstahl insgesamt und zwar:",] 
example_NationWideUntil2017 <- arrange(example_NationWideUntil2017,desc(Casenumbers))

example_NationWideSince2018 <- caseNumbers_2018[caseNumbers_2018$FederalState %like% "Bundesrepublik" & caseNumbers_2018$Crimetype %like% "Diebstahl insgesamt und zwar:",] 
example_NationWideSince2018 <- arrange(example_NationWideSince2018,desc(Casenumbers))

#Beispiel[1,1] <- "Diebstahl"
thefts_NationWideUntil2017<- as.numeric(sum(example_NationWideUntil2017$Casenumbers))
Table_thefts_NationWideUntil2017 <- addHtmlTableStyle(example_NationWideUntil2017, pos.caption = "bottom", align="lllr",align.header = "lccr") %>% htmlTable(rnames=FALSE, caption="Zahl der Diebstähle, jeweils einer Person in mehreren Ländern", label="Table_thefts_NationWideUntil2017")

thefts_NationWideSince2018<- as.numeric(sum(example_NationWideSince2018$Casenumbers))
Table_thefts_NationWideSince2018 <- addHtmlTableStyle(example_NationWideSince2018, pos.caption = "bottom", align="lllr",align.header = "lccr") %>% htmlTable(rnames=FALSE, caption="Zahl der Diebstähle, jeweils einer Person in mehreren Ländern", label="Table_thefts_NationWideSince2018")
```

Das Bundeskriminalamt stellt eine Vielzahl an Tabellen auf ihrer Website zum Download zur Verfügung.^[cf. @Bundeskriminalamt.2023] Für die Arbeit relevant sind die Falltabellen der Länder im Zeitraum von einschließlich 2014 bis 2020. Diese geben die gezählten Straftaten nach Delikt und Ländern getrennt wieder.^[cf. @Bundeskriminalamt.2021, S.17] Deliktschlüssel differenzieren und gruppieren die Fälle. Insgesamt detaillieren sie die Delikte auf 5 Ebenen. Ergänzt werden die Tabellen durch die Interpretationshilfe, die Hinweise zur Erfassung der Daten oder möglichen Verzerrungen, auaführt. Zum Beispiel das im Jahr 2018 bis 19 in Thüringen durch die Einführung eines neuen Systems, nicht alle Fallzahlen erfasst wurden.^[cf. @Bundeskriminalamt.2021b, S.4]

`r Table_Ber_TheftOnly`

[Tab. 1](#Table_Ber_TheftOnly) zeigt Fälle leichter Diebstähle in Berlin, insgesamt ergeben sich ..., bestehend aus der Gruppe Diebstähle in Betrieblichen oder Gastronomischen Räumlichkeiten. Dies verdeutlicht die Ebenen der Detailierung und muss mit vorsicht berechnet werden. Das heißt die Gesamtzahl aus Ebene 2 errechnet sich aus der Summe der beiden gezeigten Untergruppen aus Ebene 3. 

`r Table_Bremen_totalCrimeTypes`

Für die Arbeit interessanter sind deshalb die Fallzahl auf höchster Ebene. Representativ hierfür ist [Tab. 2](#Table_Bremen_totalCrimeTypes), sie offenbart für Diebstähle insgesamt eine Menge an...



Der Eintrag "Bund echte Zählung der Tatverdächtigen" ist eine separate Aufführung von Straftaten einer Person, die in verschiedenen Bundesländern registriert wurde. Dies ist ein kummulierter Sammelposten für alle Zählungen, aber exkludiert Straftaten, die in verschiedenen Bundesländern von einem Täter durchgeführt wurden.\n

`r knitr::kables(list(Table_thefts_NationWideUntil2017, Table_thefts_NationWideSince2018))` \n 
 
So zeigt die folgenden Ausgabe in [Tab. 3](#Table_thefts_NationWide), dass demnach `r toString(thefts_NationWideUntil2017)` Diebstähle erfasst, die von einer Person in mehreren Bundesländern verübt wurden. Diese werden aber nicht in den jeweils einzelnen Posten der Bundesländer, sondern in diesem Sammelposten geführt.

##	Data set of the Federal Statistical Office
##	Data Preparation
##	Modeling by using linear regression
***
#	Analysis & Results: Plots and tables from the data (3 pages).

***
#	Discussion: anomalies and limitations (0.5 - 1 page).
***
#	Conclusion: findings and implications (0.5 - 1 page).

# Kriminalitässtatistik 

***

## Datenbanken zu mehr Inhalt 

***
## Arbeitnehmerentgelte in Kreisen
- https://www.statistikportal.de/de/vgrdl/ergebnisse-kreisebene/einkommen-kreise
- Zitation^[Vgl. @Bankhofer.2008,S. 32]


## Slide with R Output und gut formatierter tabellen ausgabe

```{r cars, echo = TRUE}
knitr::kable(summary(cars),
             caption= "Zusammenfassung von cars")
knitr::kable(head(cars),
             caption="Die ersten 10 Zeilen"
             )

```

## Slide with Plot 

```{r pressure}
plot(pressure)
```


### Tabellen
Beispiel | Beispiel2
:---------:|:---------:
Inhalt | spalte2
Spalte1| Inhalt

## Interaktive Tabs {.tabset}

Sie können verschiedene Daten oder Inhalte in interaktiven Registerkarten anzeigen, indem Sie das Attribut ```.tabset``` hinter dem Namen eines Abschnitts hinzufügen, wie z.B. ```## Interaktive Registerkarten {.tabset}```. Dies bewirkt, dass alle folgenden Unterabschnitte wie ```### Cars rows 1-5``` als Tabs erscheinen:

### Cars Zeilen 1-5 {-}

```{r cars row1-5, echo=FALSE}
knitr::kable(
cars[1:5,]
)
```

###  Cars Zeilen 6-10 {-}

```{r cars row6-10, echo=FALSE}
knitr::kable(
cars[6:10,]
)
```

### Car Plot {-}
```{r cars plot in tabs, echo=FALSE, fig.height = 3}
plot(cars)
```

# Info zu geladenen Paketen
```{r Sessioninformationen laden}
## Gewährleistet Nachvollziehbarkeit in den geladenen Packeten
sessionInfo()
names(sessionInfo())
sessionInfo()[4]

```

# References
Zitate von Quellcode mit Urheber oder Gitrepository angeben oder den link