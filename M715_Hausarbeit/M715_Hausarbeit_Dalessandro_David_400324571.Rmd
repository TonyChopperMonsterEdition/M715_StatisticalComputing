---
title: "Regressionmodelling on Crimecases"
subtitle: "Modul 715 - Statistical Computing"
author: "D'Alessandro David"
date: "`r Sys.Date()`"
output:  
  #html_document:
  bookdown::html_document2:
    toc: true
    toc_float: true
    toc_depth: 2
    highlight: default 
    theme: paper
    css: "./09_Formatierung/stylesheetCaseStudy.css"
    number_sections: yes
    code_folding:  show #hide
    fig_caption: False
bibliography: "./10_Literatur_Quellen/m715_references.bib"
csl: "https://www.zotero.org/styles/apa-with-abstract"
lang: en


##Formatierung
geometry: left=2cm,right=4cm,top=2cm,bottom=2cm

knit: (function(inputFile, encoding) {
      out_dir <- "08_Report";
      rmarkdown::render(inputFile,
                        encoding=encoding, 
                        output_file=file.path(dirname(inputFile), out_dir, 'M715_Hausarbeit_Dalessandro_David_400324571.html')) })
                        
---

# Vorwort {.unnumbered}
```{r setup, include=FALSE}
# load libraries from before
#### zuvor geladen:
#library(rmarkdown)
library(knitr)
library(bookdown)
#library(yaml)

# globaloptions
knitr::opts_chunk$set(echo = FALSE)
# Tabellnaming and Counting activated --> Table X 
options(table_counter = TRUE, table_counter_str = "Table %s:", scipen = 15 )

```

<!-- ohne Nummerierung   -->

# Introduction (1 page) {#Chapter1}
***
#	Methodology (4-5 pages) {#Chapter2}
Dieses Kapitel beschreibt und erläutert zum einen die Daten des Bundeskriminalamts ([Sec. 2.1](#Section2_1)), sowie, die des Statistischen Bundesamts ([Sec. 2.2](#Section2_2)). Die Betrachtung hebt vor allem die relevanten Variablen in dieser Arbeit hervor. Zum anderen zeigt das Kapitel welche Aufbereitungsaufwände ([Sec. 2.3](#Section2_3)) notwendig sind, um die Fallzahlen zu modellieren ([Sec. 2.4](#Section2_4)). Unterstützend verwendet die Arbeit die nachfolgenden Bibliotheken.
```{r Libraries, echo=TRUE, message=FALSE, warning=FALSE}
# Libraries needed for the data exploration 
library(tidyverse)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(grid)
library(ggrepel)
library(purrr)
library(base)
library(data.table)
library(devtools)
library(htmlTable)
```

##	Data of Federal Criminal Police Office {#Section2_1}
In diesem Abschnitt fokusiert das Kapitel die Daten des Bundeskriminalamts. Es gibt Einblick in die Struktur der Datensätze und erläutert, welche Maßnahmen ([Sec. 2.3](#Section2_3)) ergreifen muss, um ein Regressionsmodell abzuleiten. Für die Beschreibung und Auswertung verwendet die Arbeit die im Code Chunk aufgeführten Skripte. Sie laden einerseits die Datensätze des Bundeskriminalamts in die Umgebung des RMarkdown und bereiten andererseits Tabellen und Grafiken vor, die das RMarkdown in diesem Abschnitt einbettet.
``` {r Datasets & Scripts,echo=TRUE, message=FALSE, warning=FALSE}
# Loading Datasets over the following scripts
source("./00_Skripte/read_PKSdatafiles.r", local = knitr::knit_global())  

# Load self scripted functions for analysis, interpretation and visualization.
source("./00_Skripte/selbstgeschriebeneFunktionen.r", local = knitr::knit_global()) 


# Calculating and creating variables to embed and use them in the paper
## Numbering of Tabels done with option()


# Smaller Thefts in Berlin in 2020 to show the example of the layers and how the figures are calculated
example_Ber <-  caseNumbers_2020[caseNumbers_2020$FederalState %like% "Berlin" & caseNumbers_2020$Crimetype %like% "Diebstahl",]
example_Ber_TheftOnly <- example_Ber[ str_detect(example_Ber$CrimeKey, "^31"),]
cssCell_4_Ber_TheftOnly <- matrix("",ncol=ncol(example_Ber_TheftOnly), nrow=nrow(example_Ber_TheftOnly))
cssCell_4_Ber_TheftOnly[str_detect(example_Ber_TheftOnly$CrimeKey, "^310\\*") | str_detect(example_Ber_TheftOnly$CrimeKey, "^315\\*",)] <- "font.size: 1.1; font-weight: bold"

Table_Ber_TheftOnly <- addHtmlTableStyle(example_Ber_TheftOnly, 
                                   pos.caption = "bottom", 
                                   align="lllr",
                                   align.header = "lccr",
                                   css.cell= cssCell_4_Ber_TheftOnly)
Table_Ber_TheftOnly <- htmlTable(Table_Ber_TheftOnly, 
                                   rnames=FALSE, 
                                   tspanner = "Simple Thefts Layer 2",
                                   n.tspanner = nrow(Table_Ber_TheftOnly),
                                   rgroup = c("Business premises (Layer 3)", "Gastronomy premises (Layer 3)"),
                                   n.rgroup = c(9,nrow(Table_Ber_TheftOnly)-9),
                                   caption="Amount of thefts on the 3. Detaildepth in the Federal State of Berlin in 2020^[adapted from @Bundeskriminalamt.2023]",
                                   label="Table_Ber_TheftOnly")

## Example for smaller Thefts
sum_Ber_TheftOnly_total <- sum(example_Ber_TheftOnly[example_Ber_TheftOnly$CrimeKey %like% "\\*", "Casenumbers"])
example_Ber_TheftOnly_gastronomic <- as.numeric(example_Ber_TheftOnly[example_Ber_TheftOnly$CrimeKey %like% "315\\*", "Casenumbers"])
example_Ber_TheftOnly_nonGastro <- as.numeric(example_Ber_TheftOnly[example_Ber_TheftOnly$CrimeKey %like% "310\\*", "Casenumbers"])
# Crimes in Berlin in 2020 to show upperlayer for each crimetype and the relevant figures for the paper
example_Ber2_totalCrimeTypes <- caseNumbers_2020[caseNumbers_2020$FederalState %like% "Berlin" & caseNumbers_2020$Crimetype %like% "insgesamt und zwar:",]
Table_Ber2_totalCrimeTypes <- addHtmlTableStyle(example_Ber2_totalCrimeTypes, 
                                   pos.caption = "bottom", 
                                   align="lllr",
                                   align.header = "lccr")
Table_Ber2_totalCrimeTypes <- htmlTable(Table_Ber2_totalCrimeTypes, 
                                   rnames=FALSE, 
                                   tspanner = "Crimecases in total per Crimetype",
                                   n.tspanner = nrow(Table_Ber2_totalCrimeTypes),
                                   caption="Total Numbers per Crimetype in Berlin in 2020^[adapted from @Bundeskriminalamt.2023]",
                                   label="Table_Ber2_totalCrimeTypes")
example_Ber2_Total <- as.numeric(example_Ber2_totalCrimeTypes[,"Casenumbers"])

# Create Variable and Table for total amount of thefts for all states and years in germany
## Parts of the tables will be displayed in the appendix
thefts_allStates_2014 <-  caseNumbers_2014[ caseNumbers_2014$Crimetype %like% "Diebstahl insgesamt und zwar:",]
thefts_allStates_2015 <-  caseNumbers_2015[ caseNumbers_2015$Crimetype %like% "Diebstahl insgesamt und zwar:",]
thefts_allStates_2017 <-  caseNumbers_2017[ caseNumbers_2017$Crimetype %like% "Diebstahl insgesamt und zwar:",]
thefts_allStates_2018 <-  caseNumbers_2018[ caseNumbers_2018$Crimetype %like% "Diebstahl insgesamt und zwar:",]
thefts_allStates_2020 <-  caseNumbers_2020[ caseNumbers_2020$Crimetype %like% "Diebstahl insgesamt und zwar:",]

## Not clear why, but "Diebstahl insgesamt und zwar" is not working for them that's why additionally CrimeKey is used
thefts_allStates_2016 <-  caseNumbers_2016[ caseNumbers_2016$Crimetype %like% "Diebstahl insgesamt und zwar:" | caseNumbers_2016$CrimeKey %like% "\\*\\*\\*\\*00",]
thefts_allStates_2019 <-  caseNumbers_2019[ caseNumbers_2019$Crimetype %like% "Diebstahl insgesamt und zwar:" | caseNumbers_2019$CrimeKey %like% "\\*\\*\\*\\*00" ,]

table_thefts_allStates2014 <- addHtmlTableStyle(thefts_allStates_2014, pos.caption = "bottom", align="lllr",align.header = "lccr") %>% htmlTable(rnames=FALSE, caption="Amount of thefts in each federal state and in germany (2014)^[adapted from @Bundeskriminalamt.2023]", label="table_thefts_allStates2014")

table_thefts_allStates2020 <- addHtmlTableStyle(thefts_allStates_2020, pos.caption = "bottom", align="lllr",align.header = "lccr") %>% htmlTable(rnames=FALSE, caption="Amount of thefts in each federal state and in germany (2020)^[adapted from @Bundeskriminalamt.2023]", label="table_thefts_allStates2020")

## Variables to show the changes in naming of a variable
example_NationWideUntil2017 <- caseNumbers_2017[caseNumbers_2017$FederalState %like% "Bund echte" & caseNumbers_2017$Crimetype %like% "Diebstahl insgesamt und zwar:",] 
example_NationWideUntil2017 <- arrange(example_NationWideUntil2017,desc(Casenumbers))

example_NationWideSince2018 <- caseNumbers_2018[caseNumbers_2018$FederalState %like% "Bundesrepublik" & caseNumbers_2018$Crimetype %like% "Diebstahl insgesamt und zwar:",] 
example_NationWideSince2018 <- arrange(example_NationWideSince2018,desc(Casenumbers))
```
Das Bundeskriminalamt stellt eine Vielzahl an Tabellen auf ihrer Website zum Download zur Verfügung.^[cf. @Bundeskriminalamt.2023] Für die Arbeit relevant sind die Falltabellen der Länder im Zeitraum von jeweils 2014 bis 2020. Sie enthalten einen Umfang von  `r  toString(totalAmount_CrimeCasesObservations) ` Observationen. Diese geben, getrennt nach Delikt und Ländern, die Anzahl an Straftaten  wieder.^[cf. @Bundeskriminalamt.2021, S.17]. Die angegebenen Deliktschlüssel erlauben es die Fälle zu differenzieren und zu gruppieren. Insgesamt detaillieren sie die Delikte auf 5 Ebenen. Ergänzt werden die Tabellen durch die Interpretationshilfe, die Hinweise zur Erfassung der Daten oder möglichen Verzerrungen, ausführt. Zum Beispiel, dass durch die Einführung eines neuen Systems im Jahr 2019 in Thüringen nicht alle Fallzahlen erfasst wurden.^[cf. @Bundeskriminalamt.2021b, S.4]

`r Table_Ber_TheftOnly`

[Table. 1](#Table_Ber_TheftOnly) verdeutlicht exemplarisch die Bedeutung der Ebenen für leichte Diebstähle in Berlin. Die Gesamtzahl leichter Diebstähle `r sum_Ber_TheftOnly_total` ergibt sich aus den Fallzahlen des regulären Betriebs (`r example_Ber_TheftOnly_nonGastro`) und des gastronomischen Betriebs (`r example_Ber_TheftOnly_gastronomic`). Die dargestellten Zahlen stammen aus der zweiten Ebene der Diebstähle, darunter spezifiziert die dritte Ebene welche Fallunterscheidungen existieren. Zum Beispiel, dass Kraftfahrzeuge im regulären Betrieb gestohlen wurden. Alle Fälle dieser Ebene ergeben in Summe die Fallzahl der darüberliegenden Ebene. Das heißt, dass ein Kummulieren der Fallzahlen nicht notwenig ist, da jede Ebene die Anzahl der Fälle aus der unteren Ebene zusammenfasst. 

`r Table_Ber2_totalCrimeTypes`

Für die Arbeit interessant sind deshalb die Fallzahl auf höchster Ebene, die im Deliktschlüssel mit mindestens einem "\*" beginnen. Repräsentativ hierfür ist [Table 2](#Table_Ber2_totalCrimeTypes), sie zeigt für Berlin mit `r  toString(example_Ber2_Total)` die Gesamtzahl der Diebstähle. Außerdem ist in der Tabelle ersichtlich, dass die höchste Ebene einer Fallart mit den Wörtern *"insgesamt und zwar:"* endet. Somit bietet die Selektion der Daten über die Spalte Crimetype eine Alternative zur Selektion über den Schlüssel.

<div class = "row">
  <div class = "column">
  `r table_thefts_allStates2014`
  </div>
  <div class = "column">
  `r table_thefts_allStates2020`
  </div>
</div>

[Table 3](#table_thefts_allStates2017) bis [Table 4](#table_thefts_allStates2020) gewähren einen Überblick aller Diebstähle in den Bundesländern. Die vorliegenden Werte bilden die Zielvariable, die die Regressionsanalyse untersucht. Im Rahmen der Datenaufbereitung müssen diese Observationen von den verbleibenden extrahiert werden. Die Aufbereitung muss diese Tabellen zusammenführen und dabei die Jahreszugehörigkeit des Observation erhalten. Die Beobachtung mit FederalState *"Bund echte Zählung der Tatverdächtigen"* oder *"Bundesrepublik Deutschland"*  ist eine separate Aufführung der Straftaten und aggregiert alle Fallzahlen der Länder. Einen Unterschied zwischen der Bezeichnung *"Bund echte Zählung der Tatverdächtigen"* oder *"Bundesrepublik Deutschland"* gibt es nicht, bis 2017 wurde die erstgenannte  und ab 2018 die letztere verwendet ([see Appendix 1][Appendix 1]).<br>
Wichtig zu wissen ist, dass sie nicht die Summe aller Fallzahlen der jeweiligen Länder ist, sondern dass Fälle, die übergreifend in verschiedenen Bundesländern stattfanden, nur einmalig erfasst werden. Somit ist dieser Wert unverzerrt, da er keine Fälle doppelt erfasst. Demnach könnten die Fallzahlen der einzelnen Bundesländern ggf. Fälle enthalten, die in anderen Bundesländern ebenfalls dokumentiert wurden. Die nachfolgende Überprüfung widerlegt diesen Sachverhalt für Diebstähle durch einen Vergleich der Summe aller Fallzahlen mit der Gesamtzahl der Bundesrepublik in den jeweiligen Jahren. 

```{r CheckBias, echo=TRUE, message=TRUE, warning=FALSE}
isBiased <- !(sum(thefts_allStates_2014[1:16,"Casenumbers"]) == thefts_allStates_2014[17,"Casenumbers"] & 
sum(thefts_allStates_2015[1:16,"Casenumbers"]) == thefts_allStates_2015[17,"Casenumbers"] & 
sum(thefts_allStates_2016[1:16,"Casenumbers"]) == thefts_allStates_2016[17,"Casenumbers"] & 
sum(thefts_allStates_2017[1:16,"Casenumbers"]) == thefts_allStates_2017[17,"Casenumbers"] & 
sum(thefts_allStates_2018[1:16,"Casenumbers"]) == thefts_allStates_2018[17,"Casenumbers"] & 
sum(thefts_allStates_2019[1:16,"Casenumbers"]) == thefts_allStates_2019[17,"Casenumbers"] & 
sum(thefts_allStates_2020[1:16,"Casenumbers"]) == thefts_allStates_2020[17,"Casenumbers"] )

isBiased

```
Abschließend bedeutet das Ergebnis `r isBiased` der Überprüfung, dass die Observationen der jeweiligen Länder keine Fallzahlen mehrfach führen. Insofern stellt jedes Bundesland im Rahmen der Diebstähle eine unverzerrte Entität dar. Für [Sec. 2.3](#Section2_3) ergab die Betrachtung der Daten das Ziel, die Tabellen der jeweiligen Jahre zusammenzuführen und die Observationen auf den Falltyp "Diebstahl insgesamt und zwar:" zu beschränken. Ein weiteres Ziel ist, dass bei der Zusammenführung die Angabe zum Jahr erhalten bleibt. Eine Anpassung der Fallartbezeichnung oder ein erhalten der Fallnummer ist nicht vorgesehen, da die Tabelle lediglich die Gesamtzahl der Diebstähle, das Jahr und Bundesland aus der Kriminalstatistik enthalten soll. Ergänzt werden die Daten durch die unabhängigen Variablen, deren Herkunft und Bedeutung der nächsten Abschnitt erläutert.

##	Data of Federal Statistical Office {#Section2_2}
Um zu überprüfen, ob die Anzahl der Diebstähle in Deutschland mit verschiedenen inländischen Faktoren zusammenhängen, untersucht die Arbeit verschiedene Faktoren auf Bundesländerebene. Dazu bedient sie sich an der Genesis-Datenbank des statistischen Bundesamts.^[@StatistischesBundesamtDeutschland.2023f] Dieser Abschnitt widmet sein Augenmerk dabei auf die Einwohnerzahl^[@StatistischesBundesamtDeutschland.2023], der Bildungs^[@StatistischesBundesamtDeutschland.2023d]- und Kulturausgaben^[@StatistischesBundesamtDeutschland.2023c], sowie der Arbeitslosenzahl^[@StatistischesBundesamtDeutschland.2023b] und der Wirtschaftskraft^[@StatistischesBundesamtDeutschland.2023e], gemessen am erzeugten Bruttoinlandsprodukt.
```{r Inhabitants, echo=TRUE, message=FALSE, warning=FALSE}

# Loading Datasets over the following scripts
source("./00_Skripte/read_GENESISdatafiles.r", local = knitr::knit_global())

## Inhabitants
table_population_per_FederalState <- addHtmlTableStyle(head(population_per_FederalState,10), pos.caption = "bottom", align="left",align.header = "left") %>% htmlTable(rnames=FALSE, caption="Population per federal state per year^[adapted from @StatistischesBundesamtDeutschland.2023]", label="table_population_per_FederalState")

table_population_per_FederalState_headerAdjusted <- addHtmlTableStyle(head(population_per_FederalState_headerAdjusted,10), pos.caption = "bottom", align="left",align.header = "left") %>% htmlTable(rnames=FALSE, caption="Population per federal state per Year with adjusted headers^[adapted from @StatistischesBundesamtDeutschland.2023]", label="table_population_per_FederalState_headerAdjusted")

```
### Inhabitants {.unlisted .tabset .tabset-fade}
#### Population per State at the End of a year {-}
`r table_population_per_FederalState `
#### Population, based on the year before {-}
`r table_population_per_FederalState_headerAdjusted`
## {.unlisted .unnumbered}
[Table 5][Population per State at the End of a year] zeigt die Einwohnerzahl aller 16 Bundesländer am Stichtag ihrer Erfassung. Aus der Dokumentation geht nicht hervor wie die Erfassung durchgeführt wurde oder, ob die sie auf einer Hochrechnung basiert. Aber, da die Bevölkerungszahl, laut den Stichtagen, am Ende des Jahres ermittelt wurde, repräsentiert sie, im Hinblick auf ihren Einfluss, das jeweils kommende Jahr. Aus diesem Grund passt das Skript beim Importieren die Tabellenüberschrift an. Als Ergebnis entsteht [Table 6][Population, based on the year before], eine strukturell gleiche Tabelle , inhaltlich gelten die Einwohnerzahlen, aber nicht mehr für das Jahr in denen die Zahlen erfasst wurden, sondern für das daraufolgende. Zur Modellierung ist die Struktur des Datensatz jedoch ungeeignet. Daher ist eine Veränderung der Tabelle notwendig, damit die Einwohnerzahl der Länder je Jahr als eigene Observationen in das Regressionsmodell einfließen. Das bedeutet, die Jahresspalten müssen in eigenständigen Entitäten die Einwohnerzahl abbilden. 

***
```{r ,echo=FALSE, fig.align = "center",  fig.id= TRUE, fig.cap="Pivoting a table into a longer, tidy form^[Fig. 12.2, taken from @GrolemundHadleyWickhamandGarrett.24.6.2023 section 12.3.1]"}

knitr::include_graphics("https://d33wubrfki0l68.cloudfront.net/3aea19108d39606bbe49981acda07696c0c7fcd8/2de65/images/tidy-9.png")
```
***
Ein Ziel der Datenaufbereitung ist das Gathering, wie sie die Autoren Garrett Grolemund und Hadley Wickham beispielhaft mit [Figure 2.1](#fig:unnamed-chunk-1) vorschlagen. Übertragen auf den Datensatz des statistischen Bundesamts bedeutetet das, dass die 7 Jahresspalten je Bundesland zu einer Entität umgewandelt werden. Diese Maßnahme erhöht die Reihenzahl von `r nrow(population_per_FederalState_headerAdjusted)` auf `r nrow(population_per_FederalState_headerAdjusted)*ncol(population_per_FederalState_headerAdjusted)` und es entsteht eine Spalte mit der Jahresangabe und eine mit der Einwohnerzahl.^[cf. @GrolemundHadleyWickhamandGarrett.24.6.2023 section 12.3.1]. Durch diese Maßnahme gewinnt die Arbeit im späteren Verlauf ein Datensatz zur Modellierung.

### Cultural Expenditure {.unlisted}
```{r Cultural Expenditure, echo=TRUE, message=FALSE, warning=FALSE}


### Missings in Educational Expenditure
#expenditure4Culture_<- expenditure4Culture[expenditure4Culture$CulturalTotalExpenditure,]
table_expenditure4Culture <- addHtmlTableStyle(summary(expenditure4Culture[,c(-(3:6),-9)], maxsum = 20), pos.caption = "bottom", align="left",align.header = "left") %>% htmlTable(rnames=FALSE, caption="Summary of the expenditures in culture (in €)", label="table_expenditure4Culture")

mean_CulturalExpenditure <- round(mean(expenditure4Culture$CulturalTotalExpenditure))
median_CulturalExpenditure <- round(median(expenditure4Culture$CulturalTotalExpenditure))

notSeenVariables <- names(expenditure4Culture[,c(3:6,9)])
missings_4_CulturalAffairsAbroad <- expenditure4Culture[is.na(expenditure4Culture$CulturalAffairsAbroad),]
missings_CulturalAffairsAbroad_detailed <- summary(expenditure4Culture[expenditure4Culture$FederalState == "Bremen" | expenditure4Culture$FederalState == "Bayern" | expenditure4Culture$FederalState == "Brandenburg"| expenditure4Culture$FederalState == "Hamburg" | expenditure4Culture$FederalState == "Hessen" | expenditure4Culture$FederalState == "Sachsen"| expenditure4Culture$FederalState== "Sachsen-Anhalt"| expenditure4Culture$FederalState == "Thüringen", c("FederalState","CulturalAffairsAbroad")], maxsum = 20)

table_missings_CulturalAffairsAbroad_detailed <- addHtmlTableStyle(missings_CulturalAffairsAbroad_detailed, pos.caption = "bottom", align="left",align.header = "left") %>% htmlTable(rnames=FALSE, caption="Detailed analysis of the federal states which contain missing values^[adapted from @StatistischesBundesamtDeutschland.2023c]", label="table_missings_CulturalAffairsAbroad_detailed")
amount_missings_4_CulturalAffairsAbroad <- nrow(expenditure4Culture[is.na(expenditure4Culture$CulturalAffairsAbroad),])

table_Hamburg_Administration4CulturalAffairs <- expenditure4Culture[expenditure4Culture$FederalState == "Hamburg", c("Year", "FederalState","Administration4CulturalAffairs")] %>% addHtmlTableStyle( pos.caption = "bottom", align="left",align.header = "left") %>% htmlTable(rnames=FALSE, caption="Detailed analysis of the federal states which contain missing values^[adapted from @StatistischesBundesamtDeutschland.2023c]", label="table_Hamburg_Administration4CulturalAffairs")
amount_missings_4_CulturalAffairsAbroad <- nrow(expenditure4Culture[is.na(expenditure4Culture$CulturalAffairsAbroad),])

```
`r table_expenditure4Culture `

In [Tab 7](#table_expenditure4Culture) zeigt die Zusammenfassung, sowohl die Struktur als auch die inhaltliche Zusammensetzung der Kulturausgaben. Zu jedem Bundesland und jedem Jahr existieren Angaben, ausgedrückt in Euro, zu den hier aufgezeigten fünf Variablen. Neben diesen, existieren noch `r notSeenVariables`. Im Gegensatz zu den aufgeführten Variablen besitzen sie keine fehlenden Werte und sind deshalb für die Betrachtung weniger interessant. Im Durchschnitt haben die Länder lt. der Spalte CulturalTotalExpenditure `r toString(mean_CulturalExpenditure)` € insgesamt für Kultur ausgegeben. Anhand des Medians `r toString(median_CulturalExpenditure)` € ist zu erkennen, dass es Länder gibt die den Durchschnitt nach oben verzerren. Die Tabelle offenbart anhand der *NA's*, dass unter anderem für die "Cultural Affairs Abroad" `r amount_missings_4_CulturalAffairsAbroad` Datenfelder keine Werte enthalten. Im Hinblick auf die Gesamtausgaben bedeutet dies, das potenzielle Verzerrungen bei der Berechnung vorliegen. Aus diesem Grund untersucht eine vertiefende Betrachtung im folgenden diesen Sachverhalt näher. 

`r table_missings_CulturalAffairsAbroad_detailed `

[Tab 8](#table_missings_CulturalAffairsAbroad_detailed) zeigt den Inhalt der Culturel Affairs Abroad detaillierter. Die Übersicht besteht zum einen aus den Ländern die fehlende Werte besitzten und zum anderen zeigt sie in Spalte zwei, dass das Maximum der Observationen bei 0 liegt. Das bedeutet, dass in den `r nrow(missings_CulturalAffairsAbroad_detailed)` Oberservationen, `r amount_missings_4_CulturalAffairsAbroad` mit fehledem Wert enthalten sind, während die verbleibenden Observationen keine Ausgaben dokumentieren. Insofern nimmt diese Arbeit an, dass die Cultural Affairs Abroad nicht von jedem Bundesland erfasst werden oder keine Ausgaben in diesem Bereich vorliegen. Ähnliche Beobachtungen und Schlussfolgerungen lassen sich für andere Bundesländer in Bezug auf die anderen Ausgabebereiche ziehen. 

`r table_Hamburg_Administration4CulturalAffairs`

Am Beispiel von Hamburg verdeutlicht [Tab 9](#table_Hamburg_Administration4CulturalAffairs), dass die im vorherigen Absatz geschilderten Erkenntnisse für die administrativen Ausgaben im Kulturbereich ebenso gelten. Somit sagen die fehlenden Werte aus der Zusammenfassung in [Tab 7](#table_expenditure4Culture) aus, dass einige Länder keine Ausgaben in den genannten Bereichen vorweisen. Auf Basis dieses Wissens schließt die Arbeit, dass die dargestellten Gesamtausgaben der Länder keine fehlenden Ausgaben enthalten, die Kulturausgaben hinreichend zusammenfassen und für die Einbettung in die das Regressionsmodell geeignet sind. Ein weiteres Ziel für [Sec. 2.3](#Section2_3) ist deshalb die Gesamtausgaben zu extrahieren und dem Datensatz für die Modellierung zuzuführen.  

### Expenditure for Education {.unlisted}
```{r Educational Expenditure, echo=TRUE, message=FALSE, warning=FALSE}

# Summary of the Expenditures for Education
summary_expenditure4Education <- addHtmlTableStyle(summary(expenditure4Education, maxsum = 20), pos.caption = "bottom", align = "left", align.header = "left") %>% htmlTable(rnames=FALSE, caption="Summary of expenditure for education^[adapted from @StatistischesBundesamtDeutschland.2023d]", label="summary_expenditure4Education")

## Get the missings
amount_missings_4_expenditure4Education <- nrow(expenditure4Education[is.na(expenditure4Education$TotalExpenditure4Education),])

### Missings in Educational Expenditure
expenditure4Education_missings<- expenditure4Education[is.na(expenditure4Education$TotalExpenditure4Education),]
table_expenditure4Education_missings <- addHtmlTableStyle(head(expenditure4Education_missings), pos.caption = "bottom", align="llllr",align.header = "llllr") %>% htmlTable(rnames=FALSE, caption="Only missings for local authorities expenditures from 3 cities^[adapted from @StatistischesBundesamtDeutschland.2023d]", label="table_expenditure4Education_missings")

### 
# Summary of the Expenditures for Education
summary_expenditure4Education_onlyTotal <- addHtmlTableStyle(summary(expenditure4Education[expenditure4Education$LevelOfSeparation == "Insgesamt",], maxsum = 20), pos.caption = "bottom") %>% htmlTable(rnames=FALSE, caption="Summary of expenditure for education^[adapted from @StatistischesBundesamtDeutschland.2023d]", label="summary_expenditure4Education_onlyTotal")

## Get Median and Mean from the Expenditures for Education
mean_expenditure4Education_onlyTotal <- round(mean(expenditure4Education$TotalExpenditure4Education[expenditure4Education$LevelOfSeparation == "Insgesamt"]))
median_expenditure4Education_onlyTotal <- round(median(expenditure4Education$TotalExpenditure4Education[expenditure4Education$LevelOfSeparation == "Insgesamt"]))
```
`r summary_expenditure4Education `

[Table 10](#summary_expenditure4Education) enthält eine Zusammenfassung der Bildungsausgaben, darunter fallen alle Mittel, die in Kindertagesstätten, Schulen, Hochschulen oder weitere ausbildende oder pädagogische Einrichtungen fließen. Von 2014 bis 2022 ist jedes Bundesland durch jeweils drei Observationen repräsentiert. Diese drei Observationen entstehen, weil der Datensatz die Geldmittel in die kummulativen **Gemeindeausgaben**, in **allgemeine Länderausgaben** und einer **zusammenfassenden Position** aus Gemeinden und Länder differenziert. Aufgrund dieser Differenzierung ist eine Betrachtung des Median und der durchschnittlichen Ausgaben noch nicht sinnvoll. Jedoch ist die Anzahl der `r toString(amount_missings_4_expenditure4Education)` fehlenden Einträge auffällig.   

`r table_expenditure4Education_missings `

Aus der Betrachtung der Missings in [Table 11](#table_expenditure4Education_missings) geht hervor, dass die Länder *Berlin, Bremen und Hamburg* keine Gemeindeausgaben ausweisen. Das liegt daran, dass diese Bundesländer Stadtstaaten sind und damit Gemeinde und Bundesland zugleich. Aufgrund dieser Besonderheit ist eine Betrachtung der einzelnen Gemeindeausgaben nicht sinnvoll. Die Arbeit fokusiert deshalb die Observationen, die die Gesamtausgaben der Länder dokumentieren. 

`r summary_expenditure4Education_onlyTotal`

Die angepasste [Table 12](#summary_expenditure4Education_onlyTotal) zeigt nun die Gesamtausgaben der Länder und legt ihre statistischen Eigenheiten offen, trotz Fokusierung auf die Gesamtausgaben, zeigt sich eine erhebliche Differenz von `r toString(mean_expenditure4Education_onlyTotal-median_expenditure4Education_onlyTotal)` zwischen dem Median `r toString(median_expenditure4Education_onlyTotal)` und dem arithmetische Mittel `r toString(mean_expenditure4Education_onlyTotal)`. Welche Auswirkung diese Differenz hat, wird in [Chapter 3](#Chapter3) beleuchtet. Daneben existiert eine Variable für die Ausgaben der Länder je Einwohner, diese wird jedoch nicht in der Arbeit verwendet, da sie bereits die Einwohnerzahl der Länder berücksichtigt. In Bezug auf die Bildungsausgaben resultiert für [Sec. 2.3](#Section2_3) die Aufgabe, die Gesamtausgaben eines Landes zu extrahieren und auf die Jahre 2014 bis 2020 zu beschränken.

### Number of Unemployed People {.unlisted}
```{r unemployment rate, echo=TRUE, message=FALSE, warning=FALSE}

# Shows the amount of unemployees in each federal state 
summary_Unemployment <- summary(jobless_people[,1:8]) %>% addHtmlTableStyle(pos.caption = "bottom", align="left", align.header = "left" ) %>% htmlTable(rnames=FALSE, caption="No missings in the table and  the structre shows federal states as colums^[adapted from @StatistischesBundesamtDeutschland.2023b]", label="summary_Unemployment")

```
`r summary_Unemployment`

Ähnlich wie bei dem Datensatz der Einwohner, ist der Datensatz für die Arbeitslosenzahlen aufgebaut. In diesem Fall liegt nach [Table 13](#summary_Unemployment) eine Variable für die Jahre vor, während die Anzahl an Arbeitslosen als Variable je Bundesland auf mehrere Spalten verteilt ist. Augrund einer verkürzten Darstellung präsentiert [Table 13](#summary_Unemployment) nicht alle Bundesländer mit ihren Zahlen. Zur besseren Nachvollziebarkeit der Problematik führt [Appendix 3][Appendix 3] eine vollständige Übersicht auf. Um eine Regressionsmodellierung durchzuführen, muss eine Pivotierung wie in [Figure 2.1](#fig:unnamed-chunk-1) für die Bundesländer erfolgen. Das bedeutet [Sec. 2.3](#Section2_3) erhält als weitere Aufgabe, die Bundesländer und die Anzahl an Arbeitslosen als eine separate Variable darzustellen. Somit entsteht eine Observation mit den Variablen für das Jahr, das Bundesland und der Fallzahl.

### Gross Domesti Product {.unlisted}
```{r gross domestic product, echo=TRUE, message=FALSE, warning=FALSE}

# Gross Domestic Product is structured similar to the inhabitants
summary_gdp<- summary(gdp_atMarketPrice[,1:7]) %>% addHtmlTableStyle(pos.caption = "bottom", align="left", align.header = "left") %>% htmlTable(rnames=FALSE, caption="No missings in the GDP-table and the structre is similar to the inhabitant^[adapted from @StatistischesBundesamtDeutschland.2023e]", tfoot =  "Figures are presented in Euro and only until 2019.", label="summary_gdp")

mean_gdp2014 <- round(mean(gdp_atMarketPrice$`2014`))
mean_gdp2019 <- round(median(gdp_atMarketPrice$`2019`))

```
`r summary_gdp`

Abschließend liefert [Table 14](#summary_gdp) einen Einblick in die Beiträge der einzelnen Länder zum Bruttoinlandsprodukt. Die Zusammenfassung impliziert zum einen, einen lückenlosen Datensatz, da keine "NAs" benannt sind. Zum anderen, ergeben sich aus der Struktur der Daten identische Ziele für [Sec. 2.3](#Section2_3) wie bei den Einwohnerzahlen. Auf inhaltlicher Ebene zeigt [Table 14](#summary_gdp), dass die Wirtschaftskraft bis 2019 steigt. 2014 lag das Bruttoinlandsprodukt bei Durchschnittlich `r mean_gdp2014` €, 5 Jahre später bei `r mean_gdp2019`€. Ob ein Einfluss auf die Kirminalfälle existiert, kann aber erst nach der Pivotierung bestimmt werden, da die Jahresangaben nicht als eigenständige Variable vorliegen. Dieser Umstand bewirkt, dass die Daten in der aktuellen Form mehrere Entitäten in einer Zeile repräsentieren und damit die Modellierung verhindern. 

Zusammenfassend zeigte dieser Abschnitt, dass die Datensätze für die Einwohner-/ Arbeitslosen- und Bruttoinlandsproduktzahlen strukturell einen ähnlichen Handlungsbedarf aufweisen. Die Datensätze für die Kultur- und Bildungsausgaben sind detailiert aufgegliederten, aber nicht in dieser Art notwendig. Außerdem zeigen sie in einigen Observationen Lücken, die logisch begründet sind und keinen Einfluss auf die relevanten Variablen haben. Somit ergeben die aufgeführten struktuellen und inhaltlichen Besonderheiten für die Datenaufbereitung im Abschnitt [Sec. 2.3](#Section2_3) folgenden Ziele: <br>
<ul>
* Pivotierung der Einwohner-, Arbeitslosen und BIP-Tabllen, so dass Observationen mit den Variablen Jahr, Bundesland, Einwohnerzahl/Arbeitslosenzahl/Bruttoinlandsprodukt entstehen
* Extraktion der Kultur-Gesamtausgaben, Ausschluss der Ausgaben je Kulturart
* Extraktion der Bildungsgesamtausgaben für die Jahre 2014-2020, Ausschluss der Ausgaben je Einwohner
* Zusammenführung aller Datensätze aller Datensätze im Hinblick auf die Regressionsmodellierung
</ul>

##	Data preparation {#Section2_3}
Aus den vorangegangenen beiden Abschnitten ([Sec. 2.1](#Section2_1)) und ([Sec. 2.2](#Section2_2)) gingen für diesen Abschnitt diverse Extraktions-, Transformationsaufgaben hervor. Sie besitzen das Ziel einen Datensatz für die Regressionsmodellierung hervorzubringen. Zuerst widmet dieser Abschnitt seine Aufmerksamkeit auf die Daten des Bundeskriminalamts. Die wichtigste Aufgabe ist die Gesamtfallzahlen der Diebstähle je Bundesland und Jahr zu selektieren und in einer Tabelle zusammenzuführen. Darüberhinaus wird dem Datensatz eine zusätzliche Variable hinzugefügt, der die Bundesländer nach ihrer Größe in 4 Kategorien einteilt. Diese Zuordnung dient in der Regressionsanalyse später um konstantwirkende Effekte zu berücksichtigen und die Aussagekraft zu verbessern.
### Prepraration of the criminal statistic data {.unlisted .unnumbered}
```{r PKS-Data-Preparation, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Add Variable Year to Dataset and combines them to one Dataset
source("./00_Skripte/combineAllYears.r", local = knitr::knit_global())

## Creats a summary table for the new Dataset
summary_Cases<- summary(caseNumbers_allYears_transformed4Summary, maxsum = 10) %>% addHtmlTableStyle(pos.caption = "bottom", align="left", align.header = "left") %>% htmlTable(rnames=FALSE, caption="Summary of all yearly reports of crimecases^[adapted from @Bundeskriminalamt.2023]", tfoot =  "Shows the years as factors to visualise the amount of observerations per year. Furthermore there are many different crimetypes listed, but necessary is only  **\"Diebstähle insgesamt und zwar\"** as mentiond in [Sec. 2.1](#Section2_1) " , label="summary_Cases")

summary_Cases
# Select Observation for Thefts , Rename Casenumbers to TheftAmount, Rename Federalstates with vowel ü, Drop Column CrimeKey and Crimetype, Drop Observation for whole Germany, 
source("./00_Skripte/varSelection_caseNumbers.r", local = knitr::knit_global())

summary_thefts<- summary(thefts_allYears_transformed4Summary, maxsum = 25) %>% addHtmlTableStyle(pos.caption = "bottom", align="left", align.header = "left") %>% htmlTable(rnames=FALSE, caption="Summary of all yearly reported thefts from 2014 until 2020^[adapted from @Bundeskriminalamt.2023]", label="summary_thefts")

```

Das erste Skript *combineAllYears.r* fasst alle einzelnen Datensätze aus den Jahren 2014 bis 2020 zu einem zusammen. [Table 15](#summary_Cases) veranschaulicht das Ergebnis und zeigt einen Ausschnitt daraus. Da der Fokus der Arbeit auf Diebstähle liegt, wird ersichtlich, dass im Datensatz viele irrelevante Observatione enthalten sind. Aus diesem Grund überführt das Skript *varSelection_caseNumbers.r* die Fallzahlen der Diebstähle in eine neue Variable **thefts_allYears_tidy**. Durch die Extraktion eine spezifischen Kriminalart, entfällt im Anschluss die Relevanz für die Spalten Crimetype und CrimeKey. Darum entfernt das Skript diese Variablen aus dem Datensatz. Zeitgleich beseitigt es letzte Unstimmigkeiten und weitere Überschüsse im Datensatzt, zum Beispiel für die Bundesländer Baden-Württemberg und Thüringen, die wegen des Umlaut **"ü"** je zwei Ausprägungen besitzen. Für eine vollständige Sicht auf die Zusammenfassung, siehe [Appendix 4][Appendix 4].

`r summary_thefts`

[Table 16](#summary_summary_thefts) zeigt die finale Version der Zusammenführung. Dabei dient **thefts_allYears_transformed4Summary** zur Veranschaulichung der Anzahl an Observationen pro Jahr. Diese ist im Datensatz gleichverteilt, da jedes Jahr, Bundesland und Bundeslandgruppe  die gleiche Anzahl an Observationen enthält. Für die Datenbearbeitung und Regressionsmodellierung liegen die Jahreszahlen weiterhin als diskete metrische Daten vor.


```{r , echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.id= TRUE, fig.cap="Mean & Median Development of thefts grouped by their Areasize of the Federal States"}
grouped_mean_thefts_by_areasize <- thefts_allYears_tidy %>% group_by(Year, Areasize) %>% summarise(TheftAmount = mean(TheftAmount))

theft_mean_developement <- ggplot(data = grouped_mean_thefts_by_areasize, aes(x = Year, y = TheftAmount, group = Areasize , color=Areasize)) +
  geom_line(size = 1) +
  scale_color_discrete(labels = c('Big (BY, BW, NW, NI)', 'Medium (BB, HE, ST, MV)', 'Small (SN, RP, TH, SH)', 'Very Small (SL, HH, BE, HB)')) +
  labs(x = "Year of Documentation", y = "Amount of Thefts" )+ 
  theme( plot.title = element_text(hjust = 0.5, size = 10, color = "black"), axis.title.y = element_text(size = 8, colour = "darkgrey"), axis.title.x = element_text(size = 8, colour = "darkgrey"))+
  theme(legend.position=c(0,.45), legend.justification =c(0,0.5), legend.text = element_text(size = 8, colour = "black"), legend.title =  element_text(size = 10), legend.background = element_rect(colour = "transparent", fill = alpha("grey", 0)))  +
  ggtitle("Mean-Development of thefts")

grouped_median_thefts_by_areasize <- thefts_allYears_tidy %>% group_by(Year, Areasize) %>% summarise(TheftAmount = median(TheftAmount))

theft_median_developement <- ggplot(data = grouped_median_thefts_by_areasize, aes(x = Year, y = TheftAmount, group = Areasize , color=Areasize)) +
  geom_line(size = 1) +
  scale_color_discrete(labels = c('Big (BY, BW, NW, NI)', 'Medium (BB, HE, ST, MV)', 'Small (SN, RP, TH, SH)', 'Very Small (SL, HH, BE, HB)')) +
  labs(x = "Year of Documentation", y = "Amount of Thefts" )+ 
  theme(legend.position = "none",plot.title = element_text(hjust = 0.5, size = 10, color = "black"), axis.title.y = element_blank(), axis.title.x = element_text(size = 8, colour = "darkgrey"))  +
  ggtitle("Median-Development of thefts")

grid.arrange(ncol=2, theft_mean_developement,theft_median_developement, widths = c(1, 0.95))
```
Die Gruppierung der Bundesländer nach ihrer Landesgröße erlaubt die grafische Betrachtung der Fallzahlen. [Fig. 2.2](#fig:unnamed-chunk-2) skiziiert auf der linken Seite, dass **große** Bundesländer eine höhere Anzahl an Diebstähle als andere aufweisen. Dies bestätigt ebenfalls der Media der gruppierten Observationen. Zu beachten ist jedoch der Unterschied zwischen Median (rechts) mit 200.000 und dem arithmetischen Mittel (links) mit 300.000 Diebstählen beginnend ab 2014.  Daneben fällt auf, dass **sehr kleine** im Vergleich zu **mittleren** und **kleinen** Bundesländer im Durchschnitt ein höhere Anzahl an Diebstählen besitzen. Allerdings legt der Median in der rechten Grafik die Vermutung nahe, dass dieses Phänomen ein Ausreiser verursacht. 

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE,  fig.id= TRUE, fig.cap="Distribution of Theafts among each group of Federal States"}

## ggarange http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/81-ggplot2-easy-way-to-mix-multiple-graphs-on-the-same-page/  ---> Tabelle muss umgewandelt werden, so dass durchschnitt erhobenwird
thefts_bp_2014 <- ggplot(data = thefts_allYears_tidy[thefts_allYears_tidy$Year == 2014, ], aes(y = TheftAmount, x=Areasize, color=Areasize, legend.p)) +
  geom_boxplot(size = 0.5) + 
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5, size = 10,color = "black")) + 
  theme(axis.title.x = element_blank(),  axis.title.y = element_text(color = "grey", size = 8))+ 
  labs(y = "Amount of Thefts" ) + 
  ggtitle("2014")

thefts_bp_2015 <- ggplot(data = thefts_allYears_tidy[thefts_allYears_tidy$Year == 2015, ], aes(y = TheftAmount, x=Areasize, color=Areasize)) +
  geom_boxplot(size = 0.5) +
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5, size = 10, color = "black")) + 
  theme(axis.title.x = element_blank(),  axis.title.y = element_blank())+
  ggtitle("2015")

thefts_bp_2019 <- ggplot(data = thefts_allYears_tidy[thefts_allYears_tidy$Year == 2019, ], aes(y = TheftAmount, x=Areasize, color=Areasize)) +
  geom_boxplot(size = 0.5) + 
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5, size = 10, color = "black")) +
  theme(axis.title.x = element_text(color = "grey", size = 8),  axis.title.y = element_text(color = "grey", size = 8))+ 
  labs(x = "Areasize of the Federal States", y = "Amount of Thefts" )+ 
  ggtitle("2019")


thefts_bp_2020 <- ggplot(data = thefts_allYears_tidy[thefts_allYears_tidy$Year == 2020, ], aes(y = TheftAmount, x=Areasize, color=Areasize)) +
  geom_boxplot(size = 0.5) + 
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5, size = 10, color = "black"))  +
  theme(axis.title.x = element_text(color = "grey", size = 8),  axis.title.y = element_blank()) + 
  labs(x = "Areasize of the Federal States") +
  ggtitle("2020")

grid.arrange(ncol=2, thefts_bp_2014, thefts_bp_2015, thefts_bp_2019, thefts_bp_2020)

```

Mithilfe der Boxplots wird die Verteilung der Diebstähle innerhalb ihrer Gruppen dargestellt, da die Gruppen je Jahr nur durch jeweils 4 Observationen repräsentiert werden, ist ihre Aussagekraft eingeschränkt. Jedoch unterstützt [Fig. 2.3](#fig:unnamed-chunk-3) das Verständnis über die Streuung der Diebstähle in den jeweiligen Gruppen. Die linke obere Grafik zeigt für das Jahr 2014 für die großen Bundesländer (rot) eine breite Streuung der Diebstahlzahlen. Der Median liegt bei ca. 200.000 Diebstählen und es exsitiert ein Ausreißer. Hierdurch wird der höhere Durchschnitt in [Fig. 2.2](#fig:unnamed-chunk-2) erklärt. Im Vergleich zu den anderen Boxplots ist das ein erheblicher Unterschied. Weiterhin ist die Streuung der Observationen in den sehr kleinen Bundesländern auffällig. Die Anzahl an Diebstählen übersteigt die größerer Bundesländer und weist eine große Spannweite auf. 


```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE, fig.a = "center",  fig.id= TRUE, fig.cap="Development of the Casenumbers in each Federal State"}

thefts_development_fS <- ggplot(data = thefts_allYears_tidy, aes(x = Year, y = TheftAmount, group = FederalState , color=FederalState)) +
  geom_line(size = 1) +
  geom_text_repel(aes(label = FederalState), data = thefts_allYears_tidy[thefts_allYears_tidy$FederalState %in% c("Nordrhein-Westfalen","Berlin", "Saarland") & thefts_allYears_tidy$Year==2020,], fontface ="plain", color = "black", size = 3) +
  theme(plot.title = element_text(hjust = 0.5, size = 10, color = "black"), legend.text = element_text(size = 8, colour = "black"),legend.title =  element_text(size = 10)) +
  theme(axis.title.x = element_text(color = "grey", size = 8),  axis.title.y = element_text(color = "grey", size = 8))+ 
  labs(x = "Year of Documentation", y = "Amount of Thefts" )
thefts_development_fS 

```
Die Einzelbetrachtung der Länder in [Fig. 2.4](#fig:unnamed-chunk-4) verdeutlicht die Beobachtungen. Nordrhein-Westfalen besitzt mit über 400.000 Fällen die höchste Anzahl an Diebstählen. Sie weicht deutlich von den Fallzahlen anderer **großer** Länder ab, die im Schnitt um 200.000 liegen. Die hohe Spanneweite aus [Fig. 2.3](#fig:unnamed-chunk-3) in den **sehr kleinen** Bundesländern ist Resultat von den merklich höheren Fallzahlen aus Berlin und der niedrigeren Fallzahlen aus dem Saarland. Bremen und Hamburg liegen genau mittig, weswegen sich der eingezeichnete Median in [Fig. 2.3](#fig:unnamed-chunk-3) kaum von den zwei nächstgrößeren Länder-Gruppen unterscheidet, aber der dargestellte Durchschnitt aus [Fig. 2.2](#fig:unnamed-chunk-2) einen höheren Wert besitzt.Die Bedeutung dieser Eigenheiten diskutiert die Arbeit erst in [Kapitel 4](#Chapter4). Der nächste Teil des Abschnitts verfolgt die Ziele aus [Sec. 2.2](#Section2_2) und behandelt die spezifischen Daten der Bundeländer.

### Preparation of specific data from the Federal States {.unlisted .unnumbered}
```{r pivoting extract exclude, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}

# Script pivotes, extracts and transforms the data as needed. Additionally it merges the Data together based on the Year and Federal State
source("./00_Skripte/prepareFederalStateData.r", local = knitr::knit_global())

summary_pivotated_Population <- tidyTable_of_population %>% addHtmlTableStyle(pos.caption = "bottom", align="left", align.header = "left") %>% htmlTable(rnames=FALSE, caption="Summary of all yearly reported inhabitants from 2014 until 2020 in each federal state^[adapted from @StatistischesBundesamtDeutschland.2023]", label="summary_pivotated_Population")

summary_mergedData <- summary(mergedData4regression) %>% addHtmlTableStyle(pos.caption = "bottom", align="left", align.header = "left") %>% htmlTable(rnames=FALSE, caption="Summary of the merged data", tfoot =  "The data includes the federal states, their grouping by areasize and the tracked years as dummy variable, the amount of thefts as the dependent variable and each specific independent variable from the number of inhabitant to the expenditures for culture. The presentation of the values in a non-scientific way was prefered from this work as it shows the diffrences among the variables.", label="summary_mergedData")

```
Das letzte Skript der Datenaufbereitung führt die in [Sec. 2.2](#Section2_2) aufgelisteten Transformationen und Extraktionen durch. Unter anderem gestaltet es die Datenstruktur für die Regressionsanalyse um. Zum Beipiel erfolgt die Pivotierung der Einwohner-, Arbeitslosen und BIP-Tabllen, so dass die Observationen je Jahr und Bundesland ihre Werte organisieren. 

`r summary_pivotated_Population`
Das Ergebnis der Pivotierung ist exemplarisch an den Einwohnerzahlen in [Table 17](#summary_pivotated_Population) erläutert. In der Tabelle gibt es eine Spalte für das Bundesland, das Jahr und die Einwohnerzahl. Insgesamt wuchs die Länge von 18 Zeilen auf 132 an (siehe [Table 5][Population per State at the End of a year] oder [Table 6][Population, based on the year before]). Nebenbei wurden die Gesamtzahlen für die Bundesrepublik entfernt, da sie für die Analyse irrelevant sind.


`r summary_mergedData`

Die Extraktion der Daten wurde bereits vor Einbettung in die Skripte in Abschnitt [Sec. 2.2](#Section2_2) vorgeführt. Im Skript werden die Selektionsmethoden genutzt, um deren Ausgabe in neue Variablen zu überführen. Während der Ausführung verbindet das Skripts sukzessive die Inkremente zu dem Datensatz **mergedData4regression**.  Eingeschlossen in das Vorgehen sind Bereinigungen und Anpassungen an das Datenformat der Variablen. Das Ergebnis stellt [Table 18](#summary_mergedData) zusammengefasst dar.^(Angemerkt sei an dieser Stelle, dass die Arbeit eine reguläre Darstellung der Zahlen präferiert, um optisch die Unterschiede zwischen den Variablen und ihrer Größenordnung darzustellen. Textuell wird die Darstellung durch Intervallpunkte unterstüzt.) Der Daten enthält zu jedem Bundesland je Jahr eine Observation und ist zusätzlich mit anderen Bundesländern nach seiner jeweiligen Fläche in einer von vier Gruppen untergebracht. Die Population gibt die Anzahl der Einwohner wieder. Die höchste, jemals in einem Bundesland, im Zeitraum von 2014 bis 2020 gemessene Einwohnerzahl ist `r prettyNum(max(mergedData4regression$Population), big.mark = ",",big.interval = 3)`. Im Durchschnitt waren von den Einwohnern Deutschlands `r prettyNum(round(mean(mergedData4regression$AmountOfUnemployedPeople)), big.mark = ",",big.interval = 3)` arbeitslos. Das Gross Domestic Product erstreckt sich  zwischen den Bundesländern von `r  prettyNum(min(mergedData4regression$GDP),big.mark = ",",big.interval = 3)`€ bishin zu `r prettyNum(max(mergedData4regression$GDP), big.mark = ",",big.interval = 3)`€. Damit weist es im Vergleich zu den Ausgaben für Bildung und Kultur die größten Milliardenbeträge vor. Im Durchschnitt lagen die Ausgaben für Bildung bei `r prettyNum(median(mergedData4regression$TotalExpenditure4Education), big.mark = ",",big.interval = 3)`  und für Kultur bei `r prettyNum(median(mergedData4regression$CulturTotalExpenditure), big.mark = ",",big.interval = 3)`. Inweiweit ein Zusammenhang zwischen den Zahlen und der Spannweite von `r prettyNum(max(mergedData4regression$TheftAmount)-min(mergedData4regression$TheftAmount), big.mark = ",",big.interval = 3)` Diebstahlfällen besteht, eruiert im folgenden Abschnitt die vorgestellte Regressionsanalyse.


```{r preparation culture, echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library("PerformanceAnalytics")
chart.Correlation(select_if(mergedData4regression[,3:9],is.numeric) , histogram=TRUE, pch=19)

```

##	Modeling by using linear regression {#Section2_4}
***
#	Analysis & Results: Plots and tables from the data (3 pages) {#Chapter3}
https://www.econometrics-with-r.org/rwpd.html#regression-with-time-fixed-effects
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
library("plm")
library("lmtest")
library("car")
mergedData4regression$Year <- as.factor(mergedData4regression$Year)
regressionModel_1 <- lm(TheftAmount ~ Population + GDP + AmountOfUnemployedPeople + TotalExpenditure4Education + CulturalTotalExpenditure, data=mergedData4regression[,-1])

summary(regressionModel_1)

regressionModel_2 <- plm(TheftAmount ~ Population + GDP + AmountOfUnemployedPeople + TotalExpenditure4Education + CulturalTotalExpenditure -1, data=mergedData4regression[,-1], index=c("Year", "Areasize"), model = "within")

summary(regressionModel_2)

coeftest(regressionModel_2, vcov = vcovHC, type = "HC1")

regressionModel_3 <- lm(TheftAmount ~ Population + GDP + AmountOfUnemployedPeople + TotalExpenditure4Education + CulturalTotalExpenditure + Areasize + Year -1, data=mergedData4regression[,-1])

summary(regressionModel_3)

coeftest(regressionModel_3, vcov = vcovHC, type = "HC1")

linearHypothesis(regressionModel_3,
                 test = "F",
                 c("AmountOfUnemployedPeople=0", "TotalExpenditure4Education=0", "CulturalTotalExpenditure=0"), 
                 vcov. = vcovHC, type = "HC1")
####

regressionModel_4 <- lm(TheftAmount ~ Population + GDP + AmountOfUnemployedPeople + TotalExpenditure4Education + CulturalTotalExpenditure + FederalState + Year -1, data=mergedData4regression[,-4])

summary(regressionModel_4)

coeftest(regressionModel_4, vcov = vcovHC, type = "HC1")

linearHypothesis(regressionModel_4,
                 test = "F",
                 c("AmountOfUnemployedPeople=0", "TotalExpenditure4Education=0", "CulturalTotalExpenditure=0"), 
                 vcov. = vcovHC, type = "HC1")

linearHypothesis(regressionModel_4,
                 test = "F",
                 c("Population=0", "GDP=0"), 
                 vcov. = vcovHC, type = "HC1")


```


***
#	Discussion: anomalies and limitations {#Chapter4}
(0.5 - 1 page)
- Ausreißer in Bezug auf die Fallzahlen sind Norrhein-Westfahlen in den **großen** und Berlin in den **sehr kleinen** Bundesländergruppen. Die Aggregation nach Größe scheint ihre Einflüsse aufgrund der Spannweite nicht sinnvoll wiederzugeben. Ob das Einführen dieser Variable als Konstante sinnvoll ist, erfordert eine separate Untersuchung und die Prüfung auf Alternativen. Zum Beispiel könnten Konstanten, die die einzelnen Länder repräsentieren bessere Variablen darstellen, allerdings erfordert ihr Gebrauch mehr Observationen als die aus den betrachteten 7 Jahren. Aus diesem Grund sollte die Auswertung der Koeffizienzen auf Basis der Regressionsanalyse vorsichtig bewerten.

***
#	Conclusion: findings and implications {#Chapter5}
(0.5 - 1 page).

Bildungsausgaben setzt sich aus mehreren Untereinheiten zusammen. Welche dieser Einheiten genau den Zusammenhang mit den Diebstählen aufweist sollte Gegenstand zukünftiger untersuchungen werden.

# Kriminalitässtatistik 

***

## Datenbanken zu mehr Inhalt 

***
## Arbeitnehmerentgelte in Kreisen
- https://www.statistikportal.de/de/vgrdl/ergebnisse-kreisebene/einkommen-kreise


## Slide with R Output und gut formatierter tabellen ausgabe

```{r cars, echo = TRUE}
knitr::kable(summary(cars),
             caption= "Zusammenfassung von cars")
knitr::kable(head(cars),
             caption="Die ersten 10 Zeilen"
             )

```

## Slide with Plot 

```{r pressure}
plot(pressure)
```


### Tabellen
Beispiel | Beispiel2
:---------:|:---------:
Inhalt | spalte2
Spalte1| Inhalt



## Interaktive Tabs {.tabset}

Sie können verschiedene Daten oder Inhalte in interaktiven Registerkarten anzeigen, indem Sie das Attribut ```.tabset``` hinter dem Namen eines Abschnitts hinzufügen, wie z.B. ```## Interaktive Registerkarten {.tabset}```. Dies bewirkt, dass alle folgenden Unterabschnitte wie ```### Cars rows 1-5``` als Tabs erscheinen:

### Cars Zeilen 1-5 {-}

```{r cars row1-5, echo=FALSE}
knitr::kable(
cars[1:5,]
)
```

###  Cars Zeilen 6-10 {-}

```{r cars row6-10, echo=FALSE}
knitr::kable(
cars[6:10,]
)
```

### Car Plot {-}
```{r cars plot in tabs, echo=FALSE, fig.height = 3}
plot(cars)
```

# Appendix
## Appendix 1 {.unnumbered .tabset .tabset-fade}
```{r renderRemaining Tabels for Cases, echo=TRUE, warning=FALSE}
table_thefts_allStates2015 <- addHtmlTableStyle(thefts_allStates_2015, pos.caption = "bottom", align="lllr",align.header = "lccr") %>% htmlTable(rnames=FALSE, caption="Zahl der Diebstähle in den Ländern und der Bundesrepublik (2015)^[adapted from @Bundeskriminalamt.2023]", label="table_thefts_allStates2015")
table_thefts_allStates2017 <- addHtmlTableStyle(thefts_allStates_2017, pos.caption = "bottom", align="lllr",align.header = "lccr") %>% htmlTable(rnames=FALSE, caption="Zahl der Diebstähle in den Ländern und der Bundesrepublik (2017)^[adapted from @Bundeskriminalamt.2023]", label="table_thefts_allStates2017")
table_thefts_allStates2016 <- addHtmlTableStyle(thefts_allStates_2016, pos.caption = "bottom", align="lllr",align.header = "lccr") %>% htmlTable(rnames=FALSE, caption="Zahl der Diebstähle in den Ländern und der Bundesrepublik (2016)^[adapted from @Bundeskriminalamt.2023]", label="table_thefts_allStates2016")
table_thefts_allStates2018 <- addHtmlTableStyle(thefts_allStates_2018, pos.caption = "bottom", align="lllr",align.header = "lccr") %>% htmlTable(rnames=FALSE, caption="Zahl der Diebstähle in den Ländern und der Bundesrepublik (2018)^[adapted from @Bundeskriminalamt.2023]", label="table_thefts_allStates2018")
table_thefts_allStates2019 <- addHtmlTableStyle(thefts_allStates_2019, pos.caption = "bottom", align="lllr",align.header = "lccr") %>% htmlTable(rnames=FALSE, caption="Zahl der Diebstähle in den Ländern und der Bundesrepublik (2019)^[adapted from @Bundeskriminalamt.2023]", label="table_thefts_allStates2019")
```

### 2014 {-}
`r table_thefts_allStates2014`
### 2015 {-}
`r table_thefts_allStates2015`

### 2016 {-}
`r table_thefts_allStates2016`
### 2017 {-}
`r table_thefts_allStates2017`
### 2018 {-}
`r table_thefts_allStates2018`
### 2019 {-}
`r table_thefts_allStates2019`
### 2020 {-}
`r table_thefts_allStates2020`
## Appendix 2 {.unnumbered}
### Information about Runtime Environment {.unnumbered}
```{r Sessioninformation, echo=TRUE, warning=FALSE, paged.print=TRUE}
## Overall Session information
sessionInfo()

```
## Appendix 3 {.unnumbered}
```{r unemployment rate appendix, echo=TRUE, message=FALSE, warning=FALSE}

# Shows the amount of unemployees in each federal state 
summary_Unemployment_full <- summary(jobless_people) %>% addHtmlTableStyle(pos.caption = "bottom") %>% htmlTable(rnames=FALSE, caption="The structre presents the amount of unemployed people by colums of federal states^[adapted from @StatistischesBundesamtDeutschland.2023b]",  tfoot= "The relevant figures are splited around many colums and the variable of federal states is only presented by column headers. To be compatible with the other datasets is has to be pivotated to a longer dataset with one column per variable. This means one observation contains a variable/column for years, one for the fedaral state and one for the amount of unemployees in that year and federal state.", label="summary_Unemployment_full")

summary_Unemployment_full
```


## Appendix 4 {.unnumbered}
```{r increased summary view, echo=TRUE, message=FALSE, warning=FALSE}

## Creats a summary table for the new Dataset
summary_Cases_total<- summary(caseNumbers_allYears_transformed4Summary, maxsum = 30) %>% addHtmlTableStyle(pos.caption = "bottom", align="left", align.header = "left") %>% htmlTable(rnames=FALSE, caption="Summary of all yearly reports of Crimecases^[adapted from @Bundeskriminalamt.2023]", tfoot =  "Shows the Years as factors to visualise the amount of observerations per year. Furthermore there are many different Crimetypes listed, but necessary is only  **\"Diebstähle insgesamt und zwar\"** as mentiond in [Sec. 2.1](#Section2_1). Additionally you can see under the FederalState 21 factors. For Baden-Württemberg and Thüringen you can see 2 possible expressions, because of the vowl *ü*. Furthermore you can see that there are Observations for **\"Bundesrepublik\"** and **\"Bund echte Zählung der Tatverdächtigen\"** which are unnecessary for this paper's regression." , label="summary_Cases_total")

summary_Cases_total
```
### List of Loaded Packages {.unnumbered}
```{r List of Loaded Packages, echo=TRUE, warning=FALSE, paged.print=TRUE}
## only Packages loaded as a list
sessionInfo_packages <- sessionInfo()[8]
toString(names(sessionInfo_packages$loadedOnly))

```
# References
Zitate von Quellcode mit Urheber oder Gitrepository angeben oder den link